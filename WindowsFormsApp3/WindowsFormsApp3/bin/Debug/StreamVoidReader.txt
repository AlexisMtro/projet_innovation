
	SET serveroutput on 

	Prompt nom ? 
	accept vnom 

	DECLARE 

		v_prenom client.PRENOM%type ;
		v_tauxrem client.TR%type ; 
		v_nocli client.CODCLI%type ; 
		v_nom client.NOMCLI%type ; 
		v_noagence client.NOAG%type ;
		v_moy number(6,2); 


	BEGIN

		SELECT PRENOM, TR , NOAG, CODCLI
		INTO v_prenom, v_tauxrem ,v_noagence , v_nocli
		FROM client
		WHERE NOMCLI = '&vnom';
		v_nom := '&vnom' ; 

		dbms_output.put_line('Ce client s appelle : ' || v_nom || ' ' || v_prenom || ' et il y a un de taux de remise de ' || v_tauxrem || '.' ) ; 

		SELECT AVG(TR)
		INTO v_moy 
		FROM client
		WHERE NOAG = v_noagence ;

		dbms_output.put_line('La moyenne de l agence de ce client est : ' || v_moy || '.' ) ; 

		if v_tauxrem < v_moy then 
			update CLIENT 
				set TR = v_moy
			where CODCLI = v_nocli ;
		else update CLIENT
			set TR = (v_tauxrem + 1) 
			where CODCLI = v_nocli ;
			END IF ; 	

		SELECT PRENOM, TR 
		INTO v_prenom, v_tauxrem
		FROM client
		WHERE NOMCLI = '&vnom';
		v_nom := '&vnom' ;

		SELECT AVG(TR)
		INTO v_moy 
		FROM client
		WHERE NOAG = v_noagence ;

		dbms_output.put_line('Ce client s appelle : ' || v_nom || ' ' || v_prenom || ' et il y a un de taux de remise de ' || v_tauxrem || '. Son agence à un taux de remise moyen de : ' || v_moy || '.'   ) ; 

	EXCEPTION 

		When NO_DATA_FOUND then
			dbms_output.put_line('Client inexistant !');

		When TOO_MANY_ROWS 
		then dbms_output.put_line('Plusieurs client, corespondent à ce nom et prénom !') ;

	END;
	/

